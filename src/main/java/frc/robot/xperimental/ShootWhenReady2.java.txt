package frc.robot.experimental;

import edu.wpi.first.wpilibj2.command.Command;
import frc.robot.subsystems.IndexSubsystem;
import frc.robot.subsystems.ShooterSubsystem2;
import frc.robot.util.IndexConstants;
import frc.robot.util.ShooterConstants;
import frc.robot.subsystems.NoteSensorSubsystem;

public class ShootWhenReady2 extends Command{
    private ShooterSubsystem2 shooter;
    private IndexSubsystem index;
    private NoteSensorSubsystem notesensor;

    public ShootWhenReady2(ShooterSubsystem2 shooter, IndexSubsystem index, NoteSensorSubsystem notesensor) {
        this.shooter = shooter;
        this.index = index;
        this.notesensor = notesensor;
        addRequirements(shooter, index, notesensor);
    }

    @Override
    public void initialize() {
        // shooter.setFlywheelToIdle();
    }

    public void execute() {
        // Turn on the shooter with setTargetFlywheelVelocity
        shooter.setFlywheelVelocity(ShooterConstants.FLYWHEEL_VELOCITY);

        // After the flywheel is at target velocity, index the game piece forward
        if (shooter.isFlywheelNominal() && notesensor.isNoteLoaded()) {
            index.setIndexPower(IndexConstants.INDEX_POWER);
        }

        // After index.HasCargo() is false, stop the shooter and index
        else if (!notesensor.isNoteLoaded()) {
            shooter.setFlywheelVelocity(0);
            index.stopIndexing();;
        }
    }

    @Override
    public void end(boolean interrupted) {
        shooter.setFlywheelVelocity(0);
    }

    @Override
    public boolean isFinished() {
        return false;
    }
}
